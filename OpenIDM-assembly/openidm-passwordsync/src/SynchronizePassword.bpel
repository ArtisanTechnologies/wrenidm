<?xml version="1.0" encoding="UTF-8"?>
<process
    name="SynchronizePassword"
    targetNamespace="http://enterprise.netbeans.org/bpel/openidm-passwordsync/SynchronizePassword"
    xmlns:tns="http://enterprise.netbeans.org/bpel/openidm-passwordsync/SynchronizePassword"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:sxt="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Trace" 
    xmlns:sxed="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor"
    xmlns:sxeh="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling" xmlns:sxed2="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor2" xmlns:ns0="http://openidm.forgerock.com/xml/ns/public/provisioning/password-1.xsd" xmlns:ns1="http://openidm.forgerock.com/xml/ns/public/model/password-1.wsdl" xmlns:sxnmp="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/NMProperty">
    <import namespace="http://openidm.forgerock.com/xml/ns/public/model/password-1.wsdl" location="password-1.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://openidm.forgerock.com/xml/ns/public/provisioning/password-1.wsdl" location="passwordSync.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <partnerLinks>
        <partnerLink name="PasswordPartnerLink" xmlns:tns="http://openidm.forgerock.com/xml/ns/public/provisioning/password-1.wsdl" partnerLinkType="tns:passwordSync" myRole="passwordSyncPortTypeRole"/>
        <partnerLink name="ModelPartnerLink" xmlns:tns="http://openidm.forgerock.com/xml/ns/public/model/password-1.wsdl" partnerLinkType="tns:password-1" partnerRole="passwordPortTypeRole"/>
    </partnerLinks>
    <variables>
        <variable name="TestOut" xmlns:tns="http://openidm.forgerock.com/xml/ns/public/provisioning/password-1.wsdl" messageType="tns:testResponseMessage"/>
        <variable name="TestIn" xmlns:tns="http://openidm.forgerock.com/xml/ns/public/provisioning/password-1.wsdl" messageType="tns:testRequestMessage"/>
        <variable name="SynchronizePasswordOut" xmlns:tns="http://openidm.forgerock.com/xml/ns/public/provisioning/password-1.wsdl" messageType="tns:synchronizePasswordResponseMessage"/>
        <variable name="ModifyPasswordOut" xmlns:tns="http://openidm.forgerock.com/xml/ns/public/model/password-1.wsdl" messageType="tns:changePasswordResponseMessage"/>
        <variable name="ModifyPasswordIn" xmlns:tns="http://openidm.forgerock.com/xml/ns/public/model/password-1.wsdl" messageType="tns:synchronizePasswordRequestMessage"/>
        <variable name="SynchronizePasswordIn" xmlns:tns="http://openidm.forgerock.com/xml/ns/public/provisioning/password-1.wsdl" messageType="tns:synchronizePasswordRequestMessage"/>
    </variables>
    <sequence>
        <pick name="Pick1" createInstance="yes">
            <onMessage partnerLink="PasswordPartnerLink" operation="test" xmlns:tns="http://openidm.forgerock.com/xml/ns/public/provisioning/password-1.wsdl" portType="tns:passwordSyncPortType" variable="TestIn">
                <sequence>
                    <assign>
                        <copy>
                            <from>string($TestIn.body/ns0:password)</from>
                            <to>$TestOut.body/ns0:decryptedPassword</to>
                        </copy>
                        <copy>
                            <from>'received'</from>
                            <to>$TestOut.body/ns0:result</to>
                        </copy>
                        <copy>
                            <from>string(sxnmp:getVariableNMProperty('TestIn', 'javax.jbi.security.subject'))</from>
                            <to>$TestOut.body/ns0:resourceName</to>
                        </copy>
                    </assign>
                    <reply name="Reply2" partnerLink="PasswordPartnerLink" operation="test" portType="tns:passwordSyncPortType" variable="TestOut"/>
                </sequence>
            </onMessage>
            <onMessage partnerLink="PasswordPartnerLink" operation="synchronizePassword" xmlns:tns="http://openidm.forgerock.com/xml/ns/public/provisioning/password-1.wsdl" portType="tns:passwordSyncPortType" variable="SynchronizePasswordIn">
                <sequence name="Sequence1">
                    <assign name="Assign1">
                        <copy>
                            <from>'received'</from>
                            <to>$SynchronizePasswordOut.body/ns0:result</to>
                        </copy>
                        <copy>
                            <from>$SynchronizePasswordIn.body/ns0:password</from>
                            <to>$ModifyPasswordIn.body/ns1:password</to>
                        </copy>
                        <copy>
                            <from>$SynchronizePasswordIn.body/ns0:clientEndpoint</from>
                            <to>$ModifyPasswordIn.body/ns1:clientEndpoint</to>
                        </copy>
                        <copy>
                            <from>$SynchronizePasswordIn.body/ns0:timestamp</from>
                            <to>$ModifyPasswordIn.body/ns1:timestamp</to>
                        </copy>
                        <copy>
                            <from>$SynchronizePasswordIn.body/ns0:identifier</from>
                            <to>$ModifyPasswordIn.body/ns1:identifier</to>
                        </copy>
                        <copy>
                            <from>string(sxnmp:getVariableNMProperty('SynchronizePasswordIn', 'javax.jbi.security.subject'))</from>
                            <to>$ModifyPasswordIn.body/ns1:subject</to>
                        </copy>
                        <copy>
                            <from>string(sxnmp:getVariableNMProperty('SynchronizePasswordIn', 'org.glassfish.openesb.messaging.messageid'))</from>
                            <to>$ModifyPasswordIn.body/ns1:messageid</to>
                        </copy>
                        <copy>
                            <from>string(sxnmp:getVariableNMProperty('SynchronizePasswordIn', 'org.glassfish.openesb.exchange.endpointname'))</from>
                            <to>$ModifyPasswordIn.body/ns1:endpointName</to>
                        </copy>
                    </assign>
                    <reply name="Reply1" partnerLink="PasswordPartnerLink" operation="synchronizePassword" xmlns:tns="http://openidm.forgerock.com/xml/ns/public/provisioning/password-1.wsdl" portType="tns:passwordSyncPortType" variable="SynchronizePasswordOut"/>
                    <invoke name="Invoke1" partnerLink="ModelPartnerLink" operation="synchronizePassword" portType="ns1:passwordPortType" inputVariable="ModifyPasswordIn" outputVariable="ModifyPasswordOut"/>
                </sequence>
            </onMessage>
        </pick>
    </sequence>
</process>








