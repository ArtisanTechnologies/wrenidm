<?xml version="1.0" encoding="UTF-8"?>

<!--
    Document   : ex1.xml
    Created on : June 28, 2010, 5:21 PM
    Author     : semancik
    Description:
        Purpose of the document follows.
-->

<!--
    WORKAROUND FOR OPENIDM-124.

    The original namspace/schema declaration should look like:

    xmlns='http://openidm.forgerock.com/xml/ns/identity/1#'

    xsi:schemaLocation='http://www.w3.org/2001/XMLSchema ../standard/XMLSchema.xsd
   http://openidm.forgerock.com/xml/ns/resource/1# ../provisioning/standard-resource-schema.xsd
   http://openidm.forgerock.com/xml/ns/identity/1# ../repository/identity.xsd
   http://openidm.forgerock.com/xml/ns/common/1# ../common/common.xsd
   http://openidm.forgerock.com/xml/ns/resource/ldap/1# ../provisioning/ldap-resource-schema.xsd
   http://openidm.forgerock.com/xml/ns/resource/unix/1# ../provisioning/unix-resource-schema.xsd'
-->

<objects  xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
   xmlns:r='http://openidm.forgerock.com/xml/ns/resource/1#'
   xmlns='http://openidm.forgerock.com/xml/ns/common/1#'
   xmlns:c='http://openidm.forgerock.com/xml/ns/common/1#'
   xmlns:ldap="http://openidm.forgerock.com/xml/ns/resource/ldap/1#"
   xmlns:unix="http://openidm.forgerock.com/xml/ns/resource/unix/1#"
   xmlns:mi6="http://mi6.gov.uk/schema/"
   xmlns:idc="http://openidm.forgerock.com/xml/ns/resource/idconnector/1#"
   xmlns:xsd="http://www.w3.org/2001/XMLSchema"
   xsi:schemaLocation='http://www.w3.org/2001/XMLSchema ../standard/XMLSchema.xsd
   http://openidm.forgerock.com/xml/ns/resource/1# ../provisioning/standard-resource-schema.xsd
   http://openidm.forgerock.com/xml/ns/common/1# ../common/common.xsd
   http://openidm.forgerock.com/xml/ns/resource/ldap/1# ../provisioning/ldap-resource-schema.xsd
   http://openidm.forgerock.com/xml/ns/resource/unix/1# ../provisioning/unix-resource-schema.xsd'>

    <user oid="007">
        <c:name>bond</c:name>
        <c:extension>
            <mi6:licence>to kill</mi6:licence>
        </c:extension>
        <fullName>James Bond 007</fullName>
        <givenName>James</givenName>
        <familyName>Bond</familyName>
        <honorificSuffix>007</honorificSuffix>
        <accountRef oid="12345"/>
        <accountRef oid="54321"/>
    </user>

    <account oid="12345">
        <c:name>bond</c:name>
        <resourceRef oid="333"/>
        <objectClass>mi6:Mi6PersonObjectClass</objectClass>
        <attributes>
            <ldap:dn>uid=bond,o=mi6</ldap:dn>
            <ldap:uid>bond</ldap:uid>
            <ldap:cn>James Bond</ldap:cn>
            <ldap:o>mi6</ldap:o>
            <mi6:mi6Licence>to kill</mi6:mi6Licence>
        </attributes>
    </account>

    <account oid="54321">
        <c:name>jbond</c:name>
        <resourceRef oid="444"/>
        <objectClass xmlns:ns1="http://openidm.forgerock.com/xml/ns/default/resource/unix4">ns1:AccountObjectClass</objectClass>
        <attributes>
            <unix:name>jbond</unix:name>
            <unix:uid>2001</unix:uid>
        </attributes>
    </account>

    <resource oid="333">
        <c:name>ds1</c:name>
        <type>http://openidm.forgerock.com/xml/ns/resource/ldap/1#LdapResource</type>
        <namespace>http://mi6.gov.uk/schema/</namespace>
        <schema>
            <xsd:schema targetNamespace="http://mi6.gov.uk/schema/">

                <!-- We will only allow imports of well-know schemas. That
                     essentialy means only parts of our "standard" resource
                     schema. The schemaLocation attribute below will not be
                     present in the final version.
                -->
                <xsd:import namespace="http://openidm.forgerock.com/xml/ns/resource/ldap/1#"/>

                <xsd:complexType name="Mi6PersonObjectClass">
                    <xsd:annotation>
                        <xsd:appinfo>
                            <r:identifier ref="ldap:dn"/>
                            <r:displayName ref="ldap:uid"/>
                            <r:nativeObjectClass>mi6Person</r:nativeObjectClass>
                        </xsd:appinfo>
                    </xsd:annotation>
                    <xsd:complexContent>
                        <xsd:extension base="ldap:InetOrgPersonObjectClass">
                            <xsd:sequence>
                                <xsd:element name="mi6Licence" type="xsd:string">
                                    <xsd:annotation>
                                        <xsd:appinfo>
                                            <c:name>Agent's Licence</c:name>
                                            <c:access>read</c:access>
                                        </xsd:appinfo>
                                    </xsd:annotation>
                                </xsd:element>
                            </xsd:sequence>
                        </xsd:extension>
                    </xsd:complexContent>
                </xsd:complexType>
                
            </xsd:schema>
        </schema>
        <schemaHandling>
            <accountType objectClass="mi6:Mi6PersonObjectClass" default="true">
                <c:name>Default Account</c:name>
                <attribute ref="ldap:cn">
                    <c:name>Common Name</c:name>
                    <c:access>read</c:access>
                </attribute>
            </accountType>
            <accountType objectClass="ldap:InetOrgPersonObjectClass"/>
            <assignableType objectClass="ldap:GroupOfUniqueMembersObjectClass">
                <c:name>LDAP Group</c:name>
                <assignmentProperty ref="ldapx:groups"/>
            </assignableType>
        </schemaHandling>
        <configuration>
            <!-- TODO -->
        </configuration>
    </resource>

    <resource oid="444">
        <c:name>unix4</c:name>
        <type>http://openidm.forgerock.com/xml/ns/resource/identityconnectors/bundles/solaris1#SolarisConnector</type>
        <namespace>http://openidm.forgerock.com/xml/ns/default/resource/unix4</namespace>
        <schema>
            <xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema" targetNamespace="http://openidm.forgerock.com/xml/ns/default/resource/unix4" xmlns:tns="http://openidm.forgerock.com/xml/ns/default/resource/unix4" xmlns:r="http://openidm.forgerock.com/xml/ns/resource/1#" xmlns:idc="http://openidm.forgerock.com/xml/ns/resource/idconnector/1#" elementFormDefault="qualified">
                <xsd:import namespace="http://openidm.forgerock.com/xml/ns/resource/idconnector/1#"/>

                <xsd:complexType name="ShellMiscObjectClass">
                    <xsd:annotation>
                        <xsd:appinfo>
                            <r:identifier ref="idc:uid"/>
                            <r:displayName ref="idc:name"/>
                        </xsd:appinfo>
                    </xsd:annotation>
                    <xsd:complexContent>
                        <xsd:extension base="idc:ObjectClass">
                            <xsd:sequence>
                                <xsd:element name="shell" type="xsd:string" maxOccurs="unbounded" minOccurs="0" />
                            </xsd:sequence>
                        </xsd:extension>
                    </xsd:complexContent>
                </xsd:complexType>

                <xsd:complexType name="GroupObjectClass">
                    <xsd:annotation>
                        <xsd:appinfo>
                            <r:identifier ref="idc:uid"/>
                            <r:displayName ref="idc:name"/>
                        </xsd:appinfo>
                    </xsd:annotation>
                    <xsd:complexContent>
                        <xsd:extension base="idc:ObjectClass">
                            <xsd:sequence>
                                <xsd:element name="users" type="xsd:string" maxOccurs="unbounded" minOccurs="0" />
                                <xsd:element name="gid" type="xsd:integer" minOccurs="0" />
                            </xsd:sequence>
                        </xsd:extension>
                    </xsd:complexContent>
                </xsd:complexType>

                <xsd:complexType name="AccountObjectClass">
                    <xsd:annotation>
                        <xsd:appinfo>
                            <r:identifier ref="idc:uid"/>
                            <r:displayName ref="idc:name"/>
                            <r:accountType default="true"/>
                            <c:name>Default Account</c:name>
                        </xsd:appinfo>
                    </xsd:annotation>
                    <xsd:complexContent>
                        <xsd:extension base="idc:ObjectClass">
                            <xsd:sequence>
                                <xsd:element name="expire" type="xsd:string" minOccurs="0" />
                                <xsd:element name="shell" type="xsd:string" minOccurs="0" />
                                <xsd:element name="group" type="xsd:string" minOccurs="0" />
                                <xsd:element name="role" type="xsd:string" maxOccurs="unbounded" minOccurs="0" />
                                <xsd:element name="authorization" type="xsd:string" maxOccurs="unbounded" minOccurs="0" />
                                <xsd:element name="secondary_group" type="xsd:string" maxOccurs="unbounded" minOccurs="0" />
                                <xsd:element name="dir" type="xsd:string" minOccurs="0" />
                                <xsd:element name="force_change" type="xsd:boolean" minOccurs="0" />
                                <xsd:element name="max" type="xsd:integer" minOccurs="0" />
                                <xsd:element name="profile" type="xsd:string" maxOccurs="unbounded" minOccurs="0" />
                                <xsd:element name="uid" type="xsd:integer" minOccurs="0" />
                                <xsd:element name="min" type="xsd:integer" minOccurs="0" />
                                <xsd:element name="comment" type="xsd:string" minOccurs="0" />
                                <xsd:element name="inactive" type="xsd:integer" minOccurs="0" />
                                <xsd:element ref="idc:password" minOccurs="0" >
                                    <xsd:annotation>
                                        <xsd:appinfo>
                                            <c:access>update</c:access>
                                            <c:access>create</c:access>
                                        </xsd:appinfo>
                                    </xsd:annotation>
                                </xsd:element>
                                <xsd:element name="time_last_login" type="xsd:string" minOccurs="0" >
                                    <xsd:annotation>
                                        <xsd:appinfo>
                                            <c:access>read</c:access>
                                            <c:access>create</c:access>
                                        </xsd:appinfo>
                                    </xsd:annotation>
                                </xsd:element>
                                <xsd:element name="warn" type="xsd:integer" minOccurs="0" />
                                <xsd:element name="lock" type="xsd:boolean" minOccurs="0" />
                            </xsd:sequence>
                        </xsd:extension>
                    </xsd:complexContent>
                </xsd:complexType>

            </xsd:schema>
        </schema>
        <schemaHandling>
            <!-- No accountType definition here needed. It is defined by schema annotation above -->
        </schemaHandling>
        <configuration>
            <!-- TODO -->
        </configuration>
    </resource>

</objects>
