<!-- ================================================================== -->
<!--                            Maven                                   -->
<!-- ================================================================== -->

<!-- This is an XML entity included in ./build.xml file -->

<!--

It contains general Maven-related stuff which usually stays unchanged
for all projects. All project specific dependencies are expected to be
in file ./project.pom.

The optional other files (project-*.pom) contain dependencies of
project parts: one file per one jar file created by this
project). They are used for uploading jar files to the Maven
repositories - the uploading tasks are in file upload2maven.xml.

EDIT the 'initmaven' task to reflect the number and names of your
project[-*].pom files.

-->

<!-- what Maven-Ant library is needed -->
<property name="maven.ant.file" value="maven-ant-tasks-2.1.0.jar"/>

<!-- ================================================================== -->
<!--      Bootstrap - a task getting here the Maven-Ant library         -->
<!-- ================================================================== -->
<target name="bootstrap" description="Fetch Maven library - needed only the first time.">

  <!-- where is Maven-Ant library -->
  <property name="maven.ant.dir" value="http://apache.hoxt.com/maven/binaries"/>

  <!-- get it -->
  <get
    src="${maven.ant.dir}/${maven.ant.file}"
    dest="${lib.dir}/${maven.ant.file}"
    verbose="true"
    usetimestamp="true"/>

</target>

<!-- ================================================================== -->
<!--      Check if we have already fetched Maven-Ant library            -->
<!-- ================================================================== -->
<target name="checkmaven"
  description="Check whether the bootstrap task was done.">

  <condition property="maven.lib.present">
    <available file="${lib.dir}/${maven.ant.file}"/>
  </condition>
  <fail unless="maven.lib.present">Sorry...
    Missing Maven library. It can be fetched from the Internet.
    Type: ant bootstrap
    This is needed only the first time.
  </fail>
  <echo message="Maven-Ant library is available: ${lib.dir}/${maven.ant.file}"/>

 <!-- http://stackoverflow.com/questions/135688/setting-environment-variables-in-os-x -->

  <property environment="env"/>
  <available property="maven.present" file="${env.M2_HOME}" type="dir"/>
  <fail unless="maven.present">Sorry...
    Missing Maven Home. Install Maven > 2.0.10 and
	set the M2_HOME variable
  </fail>
  <echo message="M2_HOME is set to = ${env.M2_HOME}"/>
</target>

<!-- ================================================================== -->
<!--                     Initialize Maven tasks                         -->
<!-- ================================================================== -->
<target name="initmaven" depends="checkmaven" description="Initialize usage of Maven">

  <typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="urn:maven-artifact-ant">
    <classpath>
      <pathelement location="${lib.dir}/${maven.ant.file}" />
    </classpath>
  </typedef>
  <!--fail unless="${env.M2_HOME}">Must set Maven Home M2_HOME variable</fail-->
 
  <!-- ADD or REMOVE lines here, depending on your project[-*].pom files -->
  <!--artifact:pom id="maven.project" file="xmls/project.pom"/>

  <artifact:remoteRepository
    id="gcp.maven.repository"
    url="${maven.repository}"/-->

  <!-- These are dependencies needed to the whole project:
       To compile and to add correct CLASSPATH into run-time scripts -->
  <!--artifact:dependencies
    pathId="dependency.classpath"
    filesetId="dependency.fileset">
    <remoteRepository refid="gcp.maven.repository" />
    <pom refid="maven.project"/>
  </artifact:dependencies-->

</target>