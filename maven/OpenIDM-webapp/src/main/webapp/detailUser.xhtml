<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<ui:composition template="resources/templates/admin-template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ice="http://www.icesoft.com/icefaces/component"
                xmlns:prefs="http://java.sun.com/jsf/composite/components/preferences"
                xmlns:comp="http://java.sun.com/jsf/composite/components/comp"
                xmlns:idm="http://openidm.forgerock.com/xml/ns/custom-taglib/"
                xmlns:c="http://java.sun.com/jsp/jstl/core">

    <ui:define name="title">#{msg['user.type.detail.title']}</ui:define>

    <ui:define name="content-title">Details for user '#{userDetailsController.user.fullName}'</ui:define>

    <ui:define name="admin-content">
        <ice:form id="admin-content">
            <ice:panelGrid columns="2">
                <idm:button action="#{userDetailsController.backPerformed}"
                            value="#{msg['button.back']}"
                            img="/resources/images/door_in.png" />

                <idm:button actionListener="#{userDetailsController.startEditMode}" value="Edit user" id="editButton"
                            img="/resources/images/user_edit.png" rendered="#{!userDetailsController.editMode}"
                            immediate="true" action="detailUser" />

                <idm:button action="#{userTypeController.fillTableList}" actionListener="#{userDetailsController.savePerformed}" id="saveButton"
                            buttonType="positive" value="Save changes" img="/resources/images/user.png"
                            rendered="#{userDetailsController.editMode}" />
            </ice:panelGrid>


            <ice:panelTabSet id="icePnlTbSet" style="width: 100%;">

                <ice:panelTab label="Repo" title="RepoTitle">
                    <ice:panelGrid columns="2"
                                   cellpadding="5px"
                                   border="0"
                                   style="font-size:14px;"
                                   id="detailUserPanelGrid" >

                        <ice:outputText value="#{msg['user.type.oid']}"/>
                        <ice:outputText id="oid" value="#{userDetailsController.user.oid}"/>

                        <ice:outputText value="#{msg['user.type.givenName']}"/>
                        <ice:outputText id="givenName" value="#{userDetailsController.user.givenName}"
                                        rendered="#{!userDetailsController.editMode}"/>
                        <ice:inputText id="givenNameText" value="#{userDetailsController.user.givenName}"
                                       rendered="#{userDetailsController.editMode}"/>

                        <ice:outputText value="#{msg['user.type.familyName']}"/>
                        <ice:outputText id="familyName" value="#{userDetailsController.user.familyName}"
                                        rendered="#{!userDetailsController.editMode}"/>
                        <ice:inputText id="familyNameText" value="#{userDetailsController.user.familyName}"
                                       rendered="#{userDetailsController.editMode}"/>

                        <ice:outputText value="#{msg['user.type.fullName']}"/>
                        <ice:outputText id="fullName" value="#{userDetailsController.user.fullName}"
                                        rendered="#{!userDetailsController.editMode}"/>
                        <ice:inputText id="fullNameText" value="#{userDetailsController.user.fullName}"
                                       rendered="#{userDetailsController.editMode}"/>

                        <ice:outputText value="#{msg['user.type.name']}"/>
                        <ice:outputText id="name" value="#{userDetailsController.user.name}"
                                        rendered="#{!userDetailsController.editMode}"/>
                        <ice:inputText id="nameText" value="#{userDetailsController.user.name}"
                                       rendered="#{userDetailsController.editMode}"/>

                        <ice:outputText value="#{msg['user.type.version']}"/>
                        <ice:outputText id="version" value="#{userDetailsController.user.version}" />

                        <ice:outputLabel value="#{msg['user.type.email']}"/>
                        <ice:outputText id="email" rendered="#{!userDetailsController.editMode}"
                                        value="#{userDetailsController.user.email}" />
                        <ice:inputText id="emailText" value="#{userDetailsController.user.email}"
                                       rendered="#{userDetailsController.editMode}"/>

                        <ice:outputLabel value="#{msg['user.type.locality']}"/>
                        <ice:outputText id="locality" rendered="#{!userDetailsController.editMode}"
                                        value="#{userDetailsController.user.locality}" />
                        <ice:inputText id="localityText"
                                       value="#{userTypeController.user.locality}"
                                       rendered="#{userDetailsController.editMode}"/>


                        <ice:outputLabel value="#{msg['user.type.password1']}" rendered="#{userDetailsController.editMode}"/>
                        <ice:panelGroup rendered="#{userDetailsController.editMode}">
                            <ice:inputSecret id="password1"
                                             value="#{userDetailsController.user.password1}"
                                             requiredMessage="#{msg['field.required']}">
                                <f:validator validatorId="PasswordValidator" />
                                <f:attribute name="otherComponentId" value="password2" />
                            </ice:inputSecret>
                            <ice:message for="password1" errorClass="error"/>
                        </ice:panelGroup>

                        <ice:outputLabel value="#{msg['user.type.password2']}" rendered="#{userDetailsController.editMode}"/>
                        <ice:panelGroup rendered="#{userDetailsController.editMode}">
                            <ice:inputSecret id="password2" immediate="true"
                                             value="#{userDetailsController.user.password2}"
                                             requiredMessage="#{msg['field.required']}"/>
                            <ice:message for="password2" errorClass="error"/>
                        </ice:panelGroup>

                        <ice:outputLabel value="#{msg['user.type.enabled']}" rendered="#{userDetailsController.editMode}"/>
                        <ice:panelGroup rendered="#{userDetailsController.editMode}">
                            <ice:selectBooleanCheckbox id="enabled"
                                                       value="#{userDetailsController.user.enabled}"
                                                       required="true"
                                                       requiredMessage="#{msg['field.required']}"/>
                            <ice:message for="enabled" errorClass="error"/>
                        </ice:panelGroup>

                        <ice:outputLabel value="#{msg['user.type.webAccessEnabled']}" rendered="#{userDetailsController.editMode}"/>
                        <ice:panelGroup rendered="#{userDetailsController.editMode}">
                            <ice:selectBooleanCheckbox id="webAccessEnabled"
                                                       value="#{userDetailsController.user.webAccessEnabled}"
                                                       required="true"
                                                       requiredMessage="#{msg['field.required']}"/>
                            <ice:message for="webAccessEnabled" errorClass="error"/>
                        </ice:panelGroup>
                    </ice:panelGrid>
                </ice:panelTab>
                <ice:panelTab rendered="true" label="Accounts" icon="resources/images/drive.png" title="Accounts">
                    <ice:outputText rendered="#{!userDetailsController.editMode}" value="This tab shows user accounts on resources." />

                    <c:forEach items="#{userDetailsController.accountList}" var="item">
                        <ice:panelGrid columns="2" style="width: 100%;" columnClasses="userDetailsResourceTableRow1,userDetailsResourceTableRow2">
                            <ice:panelCollapsible expanded="#{item.expanded}">
                                <f:facet name="header">
                                    <ice:panelGroup>
                                        <ice:outputText value="#{item.name}"/>
                                    </ice:panelGroup>
                                </f:facet>

                                <idm:schemaFormGrid bean="#{item.bean}" editable="#{userDetailsController.editMode}" />

                            </ice:panelCollapsible>
                            <idm:button action="detailUser"
                                        actionListener="#{userDetailsController.removeResourcePerformed}"
                                        value="Delete account" buttonType="negative" immediate="true"
                                        img="/resources/images/drive_delete.png" rendered="#{userDetailsController.editMode}">
                                <f:attribute name="beanId" value="#{item.id}" />
                            </idm:button>
                        </ice:panelGrid>
                    </c:forEach>
                    <br />
                    <ice:panelGrid id="manageAccountList" columns="3" rendered="#{userDetailsController.editMode}">
                        <ice:outputText value="Select resources: "/>
                        <ice:selectManyListbox id="selectAccount" size="3" style="width: auto;" partialSubmit="true"
                                               value="#{userDetailsController.selectedResourceList}">
                            <f:selectItems id="selectAccountItems" value="#{userDetailsController.availableResourceList}" />
                        </ice:selectManyListbox>

                        <idm:button id="addAccountButton" action="detailUser"
                                    actionListener="#{userDetailsController.addResourcePerformed}"
                                    value="Add account" buttonType="positive"
                                    img="/resources/images/drive_add.png" />
                    </ice:panelGrid>
                </ice:panelTab>

                <ui:remove>
                    <ice:panelTab rendered="true" label="Roles" icon="resources/images/folder_key.png" title="Roles">

                    </ice:panelTab>
                </ui:remove>
            </ice:panelTabSet>
        </ice:form>
    </ui:define>
</ui:composition>